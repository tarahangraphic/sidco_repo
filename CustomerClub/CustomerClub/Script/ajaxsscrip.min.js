
function MyAjax(Method, Action, SendData, CallBackFunction, ResponseType) {
    var http = new XMLHttpRequest();

    http.onreadystatechange = function () {


        if (http.readyState == 4) {


            if (http.status >= 200 && http.status < 300) {
                //Success
                CallBackFunction(http.response);
            }
            else {
                
                if (http.status == 550) {
                    return;
                }
                console.log(http.statusText);
                ShowErrorMessage(http.status);
            }
        }

    }

    http.onloadstart = function () {
        $(displayBox).fadeIn();
        //$.blockUI({
        //    message: $('#displayBox'),
        //    css: {
        //        top: ($(window).height() - 400) / 2 + 'px',
        //        left: ($(window).width() - 400) / 2 + 'px',
        //        width: '400px'
        //    }
        //});
    }
    http.onloadend = function () {
        $(displayBox).fadeOut();

    }
    http.responseType = "json";
    if (ResponseType != null)
        http.responseType = ResponseType;
    var data = convertquery(SendData);
    if (Method == "Get" && data != "") {
        Action += "?" + data;
        data = "";
    }
    http.open(Method, Action, true);
    http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    http.send(data);
}
function ShowErrorMessage(code) {
    var str = "خطا";

    if (code >= 400 && code < 500)
        str = "خطای سمت مشتری";
    if (code >= 500)
        str = "خطای سمت سرور";
    if (code == 401 || code == 403)
        str = " شما به این قسمت دسترسی ندارید ";
    if (code == 404)
        str = " منبع درخواستی معتبر نیست ";


    if (code == 520)
        str = "خطای فرمت";

    if (code == 521)
        str = "خطای تقسیم بر صفر";

    if (code == 522)
        str = "خطا در بازیابی رشته";

    if (code == 530)
        str = "خطای منبع داده";
    if (code == 531)
        str = "اطلاعات تکراری است";
    if (code == 533)
        str = "به پایگاه داده دسترسی ندارید";
    if (code == 532)
        str = "به دلیل اینکه این اطلاعات پیش نیاز اطلاعات دیگر هستند قابل تغییر نیستند";
    if (code == 534)
        str = "تعدا مجاز برای ثبت فقط 10 عدد میباشد";
    alert(str);
}
function convertquery(ob) {
    if (ob == null)
        return "";
    var str = "";
    var count = Object.keys(ob).length;
    var i = 0;
    for (var prop in ob) {
        i++;
        str += prop + "=" + ob[prop];
        if (i < count)
            str += "&";
    }

    return str;
}